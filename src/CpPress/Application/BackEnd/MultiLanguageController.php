<?php
namespace CpPress\Application\BackEnd;

use \Commonhelp\WP\WPController;
use \Commonhelp\App\Http\RequestInterface;
use CpPress\Application\WP\Admin\Settings;
use CpPress\Application\WP\Admin\PostMeta;
use CpPress\CpPress;

class MultiLanguageController extends WPController{
	
	private $counriesISO3166 = 'a:248:{s:2:"AF";s:11:"AFGHANISTAN";s:2:"AL";s:7:"ALBANIA";s:2:"DZ";s:7:"ALGERIA";s:2:"AS";s:14:"AMERICAN SAMOA";s:2:"AD";s:7:"ANDORRA";s:2:"AO";s:6:"ANGOLA";s:2:"AI";s:8:"ANGUILLA";s:2:"AQ";s:10:"ANTARCTICA";s:2:"AG";s:19:"ANTIGUA AND BARBUDA";s:2:"AR";s:9:"ARGENTINA";s:2:"AM";s:7:"ARMENIA";s:2:"AW";s:5:"ARUBA";s:2:"AU";s:9:"AUSTRALIA";s:2:"AT";s:7:"AUSTRIA";s:2:"AZ";s:10:"AZERBAIJAN";s:2:"BS";s:7:"BAHAMAS";s:2:"BH";s:7:"BAHRAIN";s:2:"BD";s:10:"BANGLADESH";s:2:"BB";s:8:"BARBADOS";s:2:"BY";s:7:"BELARUS";s:2:"BE";s:7:"BELGIUM";s:2:"BZ";s:6:"BELIZE";s:2:"BJ";s:5:"BENIN";s:2:"BM";s:7:"BERMUDA";s:2:"BT";s:6:"BHUTAN";s:2:"BO";s:31:"BOLIVIA, PLURINATIONAL STATE OF";s:2:"BQ";s:32:"BONAIRE, SINT EUSTATIUS AND SABA";s:2:"BA";s:22:"BOSNIA AND HERZEGOVINA";s:2:"BW";s:8:"BOTSWANA";s:2:"BV";s:13:"BOUVET ISLAND";s:2:"BR";s:6:"BRAZIL";s:2:"IO";s:30:"BRITISH INDIAN OCEAN TERRITORY";s:2:"BN";s:17:"BRUNEI DARUSSALAM";s:2:"BG";s:8:"BULGARIA";s:2:"BF";s:12:"BURKINA FASO";s:2:"BI";s:7:"BURUNDI";s:2:"KH";s:8:"CAMBODIA";s:2:"CM";s:8:"CAMEROON";s:2:"CA";s:6:"CANADA";s:2:"CV";s:10:"CAPE VERDE";s:2:"KY";s:14:"CAYMAN ISLANDS";s:2:"CF";s:24:"CENTRAL AFRICAN REPUBLIC";s:2:"TD";s:4:"CHAD";s:2:"CL";s:5:"CHILE";s:2:"CN";s:5:"CHINA";s:2:"CX";s:16:"CHRISTMAS ISLAND";s:2:"CC";s:23:"COCOS (KEELING) ISLANDS";s:2:"CO";s:8:"COLOMBIA";s:2:"KM";s:7:"COMOROS";s:2:"CG";s:5:"CONGO";s:2:"CD";s:37:"CONGO, THE DEMOCRATIC REPUBLIC OF THE";s:2:"CK";s:12:"COOK ISLANDS";s:2:"CR";s:10:"COSTA RICA";s:2:"CI";s:12:"COTE DIVOIRE";s:2:"HR";s:7:"CROATIA";s:2:"CU";s:4:"CUBA";s:2:"CW";s:7:"CURACAO";s:2:"CY";s:6:"CYPRUS";s:2:"CZ";s:14:"CZECH REPUBLIC";s:2:"DK";s:7:"DENMARK";s:2:"DJ";s:8:"DJIBOUTI";s:2:"DM";s:8:"DOMINICA";s:2:"DO";s:18:"DOMINICAN REPUBLIC";s:2:"EC";s:7:"ECUADOR";s:2:"EG";s:5:"EGYPT";s:2:"SV";s:11:"EL SALVADOR";s:2:"GQ";s:17:"EQUATORIAL GUINEA";s:2:"ER";s:7:"ERITREA";s:2:"EE";s:7:"ESTONIA";s:2:"ET";s:8:"ETHIOPIA";s:2:"FK";s:27:"FALKLAND ISLANDS (MALVINAS)";s:2:"FO";s:13:"FAROE ISLANDS";s:2:"FJ";s:4:"FIJI";s:2:"FI";s:7:"FINLAND";s:2:"FR";s:6:"FRANCE";s:2:"GF";s:13:"FRENCH GUIANA";s:2:"PF";s:16:"FRENCH POLYNESIA";s:2:"TF";s:27:"FRENCH SOUTHERN TERRITORIES";s:2:"GA";s:5:"GABON";s:2:"GM";s:6:"GAMBIA";s:2:"GE";s:7:"GEORGIA";s:2:"DE";s:7:"GERMANY";s:2:"GH";s:5:"GHANA";s:2:"GI";s:9:"GIBRALTAR";s:2:"GR";s:6:"GREECE";s:2:"GL";s:9:"GREENLAND";s:2:"GD";s:7:"GRENADA";s:2:"GP";s:10:"GUADELOUPE";s:2:"GU";s:4:"GUAM";s:2:"GT";s:9:"GUATEMALA";s:2:"GG";s:8:"GUERNSEY";s:2:"GN";s:6:"GUINEA";s:2:"GW";s:13:"GUINEA-BISSAU";s:2:"GY";s:6:"GUYANA";s:2:"HT";s:5:"HAITI";s:2:"HM";s:33:"HEARD ISLAND AND MCDONALD ISLANDS";s:2:"VA";s:29:"HOLY SEE (VATICAN CITY STATE)";s:2:"HN";s:8:"HONDURAS";s:2:"HK";s:9:"HONG KONG";s:2:"HU";s:7:"HUNGARY";s:2:"IS";s:7:"ICELAND";s:2:"IN";s:5:"INDIA";s:2:"ID";s:9:"INDONESIA";s:2:"IR";s:25:"IRAN, ISLAMIC REPUBLIC OF";s:2:"IQ";s:4:"IRAQ";s:2:"IE";s:7:"IRELAND";s:2:"IM";s:11:"ISLE OF MAN";s:2:"IL";s:6:"ISRAEL";s:2:"IT";s:5:"ITALY";s:2:"JM";s:7:"JAMAICA";s:2:"JP";s:5:"JAPAN";s:2:"JE";s:6:"JERSEY";s:2:"JO";s:6:"JORDAN";s:2:"KZ";s:10:"KAZAKHSTAN";s:2:"KE";s:5:"KENYA";s:2:"KI";s:8:"KIRIBATI";s:2:"KP";s:37:"KOREA, DEMOCRATIC PEOPLES REPUBLIC OF";s:2:"KR";s:18:"KOREA, REPUBLIC OF";s:2:"KW";s:6:"KUWAIT";s:2:"KG";s:10:"KYRGYZSTAN";s:2:"LA";s:31:"LAO PEOPLES DEMOCRATIC REPUBLIC";s:2:"LV";s:6:"LATVIA";s:2:"LB";s:7:"LEBANON";s:2:"LS";s:7:"LESOTHO";s:2:"LR";s:7:"LIBERIA";s:2:"LY";s:5:"LIBYA";s:2:"LI";s:13:"LIECHTENSTEIN";s:2:"LT";s:9:"LITHUANIA";s:2:"LU";s:10:"LUXEMBOURG";s:2:"MO";s:5:"MACAO";s:2:"MK";s:42:"MACEDONIA, THE FORMER YUGOSLAV REPUBLIC OF";s:2:"MG";s:10:"MADAGASCAR";s:2:"MW";s:6:"MALAWI";s:2:"MY";s:8:"MALAYSIA";s:2:"MV";s:8:"MALDIVES";s:2:"ML";s:4:"MALI";s:2:"MT";s:5:"MALTA";s:2:"MH";s:16:"MARSHALL ISLANDS";s:2:"MQ";s:10:"MARTINIQUE";s:2:"MR";s:10:"MAURITANIA";s:2:"MU";s:9:"MAURITIUS";s:2:"YT";s:7:"MAYOTTE";s:2:"MX";s:6:"MEXICO";s:2:"FM";s:31:"MICRONESIA, FEDERATED STATES OF";s:2:"MD";s:20:"MOLDOVA, REPUBLIC OF";s:2:"MC";s:6:"MONACO";s:2:"MN";s:8:"MONGOLIA";s:2:"ME";s:10:"MONTENEGRO";s:2:"MS";s:10:"MONTSERRAT";s:2:"MA";s:7:"MOROCCO";s:2:"MZ";s:10:"MOZAMBIQUE";s:2:"MM";s:7:"MYANMAR";s:2:"NA";s:7:"NAMIBIA";s:2:"NR";s:5:"NAURU";s:2:"NP";s:5:"NEPAL";s:2:"NL";s:11:"NETHERLANDS";s:2:"NC";s:13:"NEW CALEDONIA";s:2:"NZ";s:11:"NEW ZEALAND";s:2:"NI";s:9:"NICARAGUA";s:2:"NE";s:5:"NIGER";s:2:"NG";s:7:"NIGERIA";s:2:"NU";s:4:"NIUE";s:2:"NF";s:14:"NORFOLK ISLAND";s:2:"MP";s:24:"NORTHERN MARIANA ISLANDS";s:2:"NO";s:6:"NORWAY";s:2:"OM";s:4:"OMAN";s:2:"PK";s:8:"PAKISTAN";s:2:"PW";s:5:"PALAU";s:2:"PS";s:19:"PALESTINE, STATE OF";s:2:"PA";s:6:"PANAMA";s:2:"PG";s:16:"PAPUA NEW GUINEA";s:2:"PY";s:8:"PARAGUAY";s:2:"PE";s:4:"PERU";s:2:"PH";s:11:"PHILIPPINES";s:2:"PN";s:8:"PITCAIRN";s:2:"PL";s:6:"POLAND";s:2:"PT";s:8:"PORTUGAL";s:2:"PR";s:11:"PUERTO RICO";s:2:"QA";s:5:"QATAR";s:2:"RE";s:7:"REUNION";s:2:"RO";s:7:"ROMANIA";s:2:"RU";s:18:"RUSSIAN FEDERATION";s:2:"RW";s:6:"RWANDA";s:2:"BL";s:20:"SAINT BARTH√âLEMY";s:2:"SH";s:44:"SAINT HELENA, ASCENSION AND TRISTAN DA CUNHA";s:2:"KN";s:21:"SAINT KITTS AND NEVIS";s:2:"LC";s:11:"SAINT LUCIA";s:2:"MF";s:26:"SAINT MARTIN (FRENCH PART)";s:2:"PM";s:25:"SAINT PIERRE AND MIQUELON";s:2:"VC";s:32:"SAINT VINCENT AND THE GRENADINES";s:2:"WS";s:5:"SAMOA";s:2:"SM";s:10:"SAN MARINO";s:2:"ST";s:21:"SAO TOME AND PRINCIPE";s:2:"SA";s:12:"SAUDI ARABIA";s:2:"SN";s:7:"SENEGAL";s:2:"RS";s:6:"SERBIA";s:2:"SC";s:10:"SEYCHELLES";s:2:"SL";s:12:"SIERRA LEONE";s:2:"SG";s:9:"SINGAPORE";s:2:"SX";s:25:"SINT MAARTEN (DUTCH PART)";s:2:"SK";s:8:"SLOVAKIA";s:2:"SI";s:8:"SLOVENIA";s:2:"SB";s:15:"SOLOMON ISLANDS";s:2:"SO";s:7:"SOMALIA";s:2:"ZA";s:12:"SOUTH AFRICA";s:2:"GS";s:44:"SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS";s:2:"SS";s:11:"SOUTH SUDAN";s:2:"ES";s:5:"SPAIN";s:2:"LK";s:9:"SRI LANKA";s:2:"SD";s:5:"SUDAN";s:2:"SR";s:8:"SURINAME";s:2:"SJ";s:22:"SVALBARD AND JAN MAYEN";s:2:"SZ";s:9:"SWAZILAND";s:2:"SE";s:6:"SWEDEN";s:2:"CH";s:11:"SWITZERLAND";s:2:"SY";s:20:"SYRIAN ARAB REPUBLIC";s:2:"TW";s:25:"TAIWAN, PROVINCE OF CHINA";s:2:"TJ";s:10:"TAJIKISTAN";s:2:"TZ";s:28:"TANZANIA, UNITED REPUBLIC OF";s:2:"TH";s:8:"THAILAND";s:2:"TL";s:11:"TIMOR-LESTE";s:2:"TG";s:4:"TOGO";s:2:"TK";s:7:"TOKELAU";s:2:"TO";s:5:"TONGA";s:2:"TT";s:19:"TRINIDAD AND TOBAGO";s:2:"TN";s:7:"TUNISIA";s:2:"TR";s:6:"TURKEY";s:2:"TM";s:12:"TURKMENISTAN";s:2:"TC";s:24:"TURKS AND CAICOS ISLANDS";s:2:"TV";s:6:"TUVALU";s:2:"UG";s:6:"UGANDA";s:2:"UA";s:7:"UKRAINE";s:2:"AE";s:20:"UNITED ARAB EMIRATES";s:2:"GB";s:14:"UNITED KINGDOM";s:2:"US";s:13:"UNITED STATES";s:2:"UM";s:36:"UNITED STATES MINOR OUTLYING ISLANDS";s:2:"UY";s:7:"URUGUAY";s:2:"UZ";s:10:"UZBEKISTAN";s:2:"VU";s:7:"VANUATU";s:2:"VE";s:33:"VENEZUELA, BOLIVARIAN REPUBLIC OF";s:2:"VN";s:8:"VIET NAM";s:2:"VG";s:23:"VIRGIN ISLANDS, BRITISH";s:2:"VI";s:20:"VIRGIN ISLANDS, U.S.";s:2:"WF";s:17:"WALLIS AND FUTUNA";s:2:"EH";s:14:"WESTERN SAHARA";s:2:"YE";s:5:"YEMEN";s:2:"ZM";s:6:"ZAMBIA";s:2:"ZW";s:8:"ZIMBABWE";}';
	private $languagesISO939 = 'a:135:{s:2:"en";s:7:"English";s:2:"aa";s:4:"Afar";s:2:"ab";s:9:"Abkhazian";s:2:"af";s:9:"Afrikaans";s:2:"am";s:7:"Amharic";s:2:"ar";s:6:"Arabic";s:2:"as";s:8:"Assamese";s:2:"ay";s:6:"Aymara";s:2:"az";s:11:"Azerbaijani";s:2:"ba";s:7:"Bashkir";s:2:"be";s:12:"Byelorussian";s:2:"bg";s:9:"Bulgarian";s:2:"bh";s:6:"Bihari";s:2:"bi";s:7:"Bislama";s:2:"bn";s:14:"Bengali/Bangla";s:2:"bo";s:7:"Tibetan";s:2:"br";s:6:"Breton";s:3:"cat";s:7:"Catalan";s:2:"co";s:8:"Corsican";s:2:"cs";s:5:"Czech";s:2:"cy";s:5:"Welsh";s:2:"da";s:6:"Danish";s:2:"de";s:6:"German";s:2:"dz";s:7:"Bhutani";s:2:"el";s:5:"Greek";s:2:"eo";s:9:"Esperanto";s:2:"es";s:7:"Spanish";s:2:"et";s:8:"Estonian";s:2:"eu";s:6:"Basque";s:2:"fa";s:7:"Persian";s:2:"fi";s:7:"Finnish";s:2:"fj";s:4:"Fiji";s:2:"fo";s:8:"Faeroese";s:2:"fr";s:6:"French";s:2:"fy";s:7:"Frisian";s:2:"ga";s:5:"Irish";s:2:"gd";s:12:"Scots/Gaelic";s:2:"gl";s:8:"Galician";s:2:"gn";s:7:"Guarani";s:2:"gu";s:8:"Gujarati";s:2:"ha";s:5:"Hausa";s:2:"hi";s:5:"Hindi";s:2:"hr";s:8:"Croatian";s:2:"hu";s:9:"Hungarian";s:2:"hy";s:8:"Armenian";s:2:"ia";s:11:"Interlingua";s:2:"ie";s:11:"Interlingue";s:2:"ik";s:7:"Inupiak";s:2:"in";s:10:"Indonesian";s:2:"is";s:9:"Icelandic";s:2:"it";s:7:"Italian";s:2:"iw";s:6:"Hebrew";s:2:"ja";s:8:"Japanese";s:2:"ji";s:7:"Yiddish";s:2:"jw";s:8:"Javanese";s:2:"ka";s:8:"Georgian";s:2:"kk";s:6:"Kazakh";s:2:"kl";s:11:"Greenlandic";s:2:"km";s:9:"Cambodian";s:2:"kn";s:7:"Kannada";s:2:"ko";s:6:"Korean";s:2:"ks";s:8:"Kashmiri";s:2:"ku";s:7:"Kurdish";s:2:"ky";s:7:"Kirghiz";s:2:"la";s:5:"Latin";s:2:"ln";s:7:"Lingala";s:2:"lo";s:8:"Laothian";s:2:"lt";s:10:"Lithuanian";s:2:"lv";s:15:"Latvian/Lettish";s:2:"mg";s:8:"Malagasy";s:2:"mi";s:5:"Maori";s:2:"mk";s:10:"Macedonian";s:2:"ml";s:9:"Malayalam";s:2:"mn";s:9:"Mongolian";s:2:"mo";s:9:"Moldavian";s:2:"mr";s:7:"Marathi";s:2:"ms";s:5:"Malay";s:2:"mt";s:7:"Maltese";s:2:"my";s:7:"Burmese";s:2:"na";s:5:"Nauru";s:2:"ne";s:6:"Nepali";s:2:"nl";s:5:"Dutch";s:2:"no";s:9:"Norwegian";s:2:"oc";s:7:"Occitan";s:2:"om";s:20:"(Afan)/Oromoor/Oriya";s:2:"pa";s:7:"Punjabi";s:2:"pl";s:6:"Polish";s:2:"ps";s:13:"Pashto/Pushto";s:2:"pt";s:10:"Portuguese";s:2:"qu";s:7:"Quechua";s:2:"rm";s:14:"Rhaeto-Romance";s:2:"rn";s:7:"Kirundi";s:2:"ro";s:8:"Romanian";s:2:"ru";s:7:"Russian";s:2:"rw";s:11:"Kinyarwanda";s:2:"sa";s:8:"Sanskrit";s:2:"sd";s:6:"Sindhi";s:2:"sg";s:6:"Sangro";s:2:"sh";s:14:"Serbo-Croatian";s:2:"si";s:10:"Singhalese";s:2:"sk";s:6:"Slovak";s:2:"sl";s:9:"Slovenian";s:2:"sm";s:6:"Samoan";s:2:"sn";s:5:"Shona";s:2:"so";s:6:"Somali";s:2:"sq";s:8:"Albanian";s:2:"sr";s:7:"Serbian";s:2:"ss";s:7:"Siswati";s:2:"st";s:7:"Sesotho";s:2:"su";s:9:"Sundanese";s:2:"sv";s:7:"Swedish";s:2:"sw";s:7:"Swahili";s:2:"ta";s:5:"Tamil";s:2:"te";s:6:"Tegulu";s:2:"tg";s:5:"Tajik";s:2:"th";s:4:"Thai";s:2:"ti";s:8:"Tigrinya";s:2:"tk";s:7:"Turkmen";s:2:"tl";s:7:"Tagalog";s:2:"tn";s:8:"Setswana";s:2:"to";s:5:"Tonga";s:2:"tr";s:7:"Turkish";s:2:"ts";s:6:"Tsonga";s:2:"tt";s:5:"Tatar";s:2:"tw";s:3:"Twi";s:2:"uk";s:9:"Ukrainian";s:2:"ur";s:4:"Urdu";s:2:"uz";s:5:"Uzbek";s:2:"vi";s:10:"Vietnamese";s:2:"vo";s:7:"Volapuk";s:2:"wo";s:5:"Wolof";s:2:"xh";s:5:"Xhosa";s:2:"yo";s:6:"Yoruba";s:2:"zh";s:7:"Chinese";s:2:"zu";s:4:"Zulu";}';
	
	public function __construct($appName, RequestInterface $request, $templateDirs = array()){
		parent::__construct($appName, $request, $templateDirs);
		
	}
	
	public function language($country){
		$countries = unserialize($this->counriesISO3166);
		$languages = unserialize($this->languagesISO939);
		$flagDir = dirname(dirname(plugin_dir_path(CpPress::$FILE))) . '/assets/flags/4x3';
		$flags = glob($flagDir . '/*.svg');
		$this->assign('selectedCountry', $country);
		$this->assign('countries', $countries);
		$this->assign('languages', $languages);
		$this->assign('flags', $flags);
	}
	
	public function save($id){
		if(defined('DOING_AUTOSAVE') && DOING_AUTOSAVE){
			return;
		}
	
		if(is_null($this->getParam('_cppress_multilanguage_nonce')) || !wp_verify_nonce($this->getParam('_cppress_multilanguage_nonce'), 'save')){
			return;
		}
		
		if($this->getParam('cp-press-country', null) !== null){
			$files = $this->getParam('cp-press-country');
			update_post_meta($id, 'cp-press-country', $files);
		}
	}
	
}